<html>

<head>
  <title>SUBARU Download Request</title>
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">
</head>

<body>
  <main class="container">
    <em id="message" style="display: none;"></em>
    <form action="http://smoka.nao.ac.jp/datarequest" id="smoka_form" method="POST" style="display: none;">
      <input type="hidden" name="action" value="Datarequest" />
      <input type="hidden" name="search_type" value="" />
      <!-- Script below will add inputs to the form. -->
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </main>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <script type="application/javascript">
    $(document).ready(function () {
      var $form = $("#smoka_form")

      function appendInput(val) {
        var $input = $('<input type="hidden" name="frameinfo" />').appendTo($form)
        $input.val(val)
      }

      var frameIDTypeDictionary = { 'X': 9, 'Y': 8 }      
      var query = window.location.search.replace('?', '')
      var queryItems = query.split('&')

      for (var i = 0, ql = queryItems.length; i < ql; i++) {
        var nextItem = queryItems[i].split('=')

        if ((nextItem.length === 2) && (nextItem[0] === 'frameinfo')) {
          var paramItems = decodeURIComponent(nextItem[1]).split('/')
          var date = paramItems[0]
          var frameIDDesc = paramItems[1]
          var frameIDType = frameIDDesc.slice(-1) // Last character
          var count = frameIDTypeDictionary[frameIDType]

          // May not end in one of the dictionary values.
          if (count) {
            for (var i = 1; i <= count; i++) {
              var s = frameIDDesc
              appendInput(decodeURIComponent(s.replace(frameIDType, i)) + ' ' + date)
            }
          } else {
              appendInput(frameIDDesc + ' ' + date)
          }
        }
      }

      if ($form.find('input[name="frameinfo"]').length > 0) {
        $('#message').text('Submitting your request to SUBARU...').show()
        $form.submit()
      } else {
        $('#message').text('Request this page with ?frameinfo=<YYYY-MM-DD>/<FRAMEID>').show()
      }
    })
  </script>
</body>

</html>
